(import (scheme base)(scheme write))

(define-syntax expr
   (syntax-rules ()
      ((_ x ...) (state-0 (x ...) () ()))))

(define-syntax state-0-EXPR
   (syntax-rules ()
      ((_ () () (x))	x)
      ((_ x ...)	(syntax-error "state-0-EXPR: invalid expression" x ...))))

(include "generated-expr.scm")

(display "HELLO\n")
(display (expr 2))
(newline)
(display (expr 2 + 3))
(newline)

(define-syntax disp
   (syntax-rules ()
      ((disp x ...) (for-each display (list x ...)))))

(define-syntax show
   (syntax-rules ()
      ((show x ...) (begin (disp 'x " ==>> " x "\n") ...))))

(define (f c) (+ c 8))
(define vec #(0 1 2 3 4 5 6))
(define bvec #u8(0 1 2 3 4 5 6))
(define lst '(0 1 2 3 4 5 6))

(show
      (expr - 5)
      (expr 5)
      (expr 5 + 5)
      (expr 5 + 5 - 5)
      (expr 10 - 5 - 2)
      (expr 10 - 5 - 2 * 8)
      (expr 5 * 5)
      (expr 2 * 5 ^ 2)
      (expr 5 * 5 + 5)
      (expr 5 * (5 + 5))
      (expr 5 * 5 / 4)
      (expr 5 * 5 : 4)
      (expr 5 * 5 % 3)
      (expr 5 * (5 % 3))
      (expr (5 * 5) % 3)
      (expr 5 + ((f 4)))
      (expr 1 + 2 < 2 + 2 < 3 + 2)
      (expr 1 < 2 < 3 and 3 > 2 > 1)
      (expr 1 < 2 < 3 and 3 > 2 > 8)
      (expr vec @ 2)
      (expr vec @ 5)
      (expr bvec @@ 2)
      (expr bvec @@ 5)
      (expr lst @. 2)
      (expr lst @. 5)
)

(define-syntax test
  (syntax-rules ()
    ((_ . x) (disp '(expr . x) " => " (expr . x) "\n"))))

(define one   1)
(define two   2)
(define three 3)
(define four  4)
(define five  5)

(test five)
(test 10)
(test - 5)
(test 10 ^ 3)
(test 100 % 16)
(test 100 : 16)
(test 100 / 16)
(test 100 * 16)
(test 100 - 16)
(test 100 + 16)
(test (100 + 16))
(test 2 * (10 - 5))
(test 4 - 1 - 1)

(test four - one - one)
(test ((even? four)))
(test ((odd? four)))

(test 4 < 5)
(test 5 < 4)
(test 5 < 5)
(test 4 > 5)
(test 5 > 4)
(test 5 > 5)
(test 4 = 5)
(test 5 = 4)
(test 5 = 5)
(test 4 <= 5)
(test 5 <= 4)
(test 5 <= 5)
(test 4 >= 5)
(test 5 >= 4)
(test 5 >= 5)
(test 4 <> 5)
(test 5 <> 4)
(test 5 <> 5)

(test four > two and "ok")
(test four < two and "not ok")
(test four > two or "not ok")
(test four < two or " ok")
(test 1 < 2 eqv 7 > 8)
(test 1 < 2 eqv 7 < 8)
(test 1 > 2 eqv 7 > 8)
(test 1 > 2 eqv 7 < 8)
(test 1 < 2 not eqv 7 > 8)
(test 1 < 2 not eqv 7 < 8)
(test 1 > 2 not eqv 7 > 8)
(test 1 > 2 not eqv 7 < 8)
(test 1 < 2 implies 7 > 8)
(test 1 < 2 implies 7 < 8)
(test 1 > 2 implies 7 > 8)
(test 1 > 2 implies 7 < 8)

(test #t or  1 : 0 < 0 and #t)
(test #f or  #f and 1 : 0 < 0)

(test 100 : 2 + 2)
(test 100 : 2 + 2 * 5)
(test 100 : 2 : 5 + 2 * 5)
(test 100 : 2 : 5 - 5 + 2 * 5 - 10)

(test 1 : 0 if #f else 2)
(test 1 if #t else 2 : 0)
